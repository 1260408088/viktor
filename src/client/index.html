<!DOCTYPE html>
<html lang="en"><head>

	<!-- Meta: General -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Viktor NV-1 Synthesizer.">
	<meta name="author" content="Nikolay Tsenkov.">
	<!-- <link rel="shortcut icon" href="images/favicon.ico"> -->

	<title>Viktor NV-1 Synthesizer</title>

	<!-- Meta: Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@nikolaytsenkov">
	<meta name="twitter:creator" content="@nikolaytsenkov">
	<meta name="twitter:title" content="Viktor NV-1. Synthesizer Built on the Web Audio API.">
	<meta name="twitter:description" content="Play the NV-1 using your MIDI keyboard, supported through the new Web MIDI API. Save your custom patches, import and export complete libraries.">
	<meta name="twitter:image" content="http://nicroto.github.io/viktor/images/cards/twitter-card.jpg">

	<!-- Meta: Facebook/OpenGraph -->
	<meta property="og:type" content="website">
	<meta property="og:site_name" content="Viktor NV-1">
	<meta property="og:url" content="http://nicroto.github.io/viktor/">
	<meta property="og:title" content="Viktor NV-1 Synthesizer">
	<meta property="og:description" content="Synthesizer built with the Web Audio API. Play using your MIDI keyboard. Save your custom patches, export your library or import libraries created by others.">
	<meta property="og:image" content="http://nicroto.github.io/viktor/images/cards/facebook-card.jpg">

	<!-- Bootstrap Core CSS -->
	<link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- WebAudio Controls -->
	<script src="non-bower/webaudio-controls/bower_components/webcomponentsjs/webcomponents.js"></script>
	<link rel="import" href="non-bower/webaudio-controls/bower_components/polymer/polymer.html">
	<link rel="import" href="non-bower/webaudio-controls/webcomponents/webaudio-controls.html">

	<!-- Fonts -->
	<link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

	<!-- Custom CSS -->
	<link href="css/main.css" rel="stylesheet">

	<!-- Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-63593643-1', 'auto');
		ga('send', 'pageview');
	</script>

</head><body ng-app="app" polymer-ready>

	<!-- Social Buttons part1 -->
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=1435210983455180";
		fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>

	<button id="loadSynthButton" class="hide centered viktor btn">Load Synth</button>

	<daw-container></daw-container>
	<canvas id="canvas" style="display:block;margin:auto;width: 50%;height:350px;"></canvas>
	<script type="text/javascript">
		function bugfixBootstrap(){
			var daw = window.dawEngine,
				canvas = document.getElementById( "canvas" ),
				canvasCtx = canvas.getContext( "2d" ),
				WIDTH = canvas.width,
				HEIGHT = canvas.height;

			console.log( "canvas is " + ( canvas ? "a go" : "no go..." ) );
			console.log( "dawEngine is " + ( daw ? "a go" : "no go..." ) );

			var analyser = window.analyser = daw.audioContext.createAnalyser();

			// tap into the synth's output (before effects)
			daw.instruments[ 0 ].voices[0].gainEnvelope.node.connect( analyser );

			analyser.fftSize = 2048;
			var bufferLength = analyser.fftSize;
			console.log( "bufferLength: " + bufferLength );
			var dataArray = new Uint8Array( bufferLength );

			canvasCtx.clearRect( 0, 0, WIDTH, HEIGHT );

			function draw() {

				drawVisual = requestAnimationFrame( draw );

				analyser.getByteTimeDomainData( dataArray );

				canvasCtx.fillStyle = 'rgb(200, 200, 200)';
				canvasCtx.fillRect( 0, 0, WIDTH, HEIGHT );

				canvasCtx.lineWidth = 2;
				canvasCtx.strokeStyle = 'rgb(0, 0, 0)';

				canvasCtx.beginPath();

				var sliceWidth = WIDTH * 1.0 / bufferLength;
				var x = 0;

				var sum = 0;
				for( var i = 0; i < bufferLength; i++ ) {

					sum += dataArray[i];
					var v = dataArray[ i ] / 128.0;
					var y = v * HEIGHT/2;

					if(i === 0) {
						canvasCtx.moveTo( x, y );
					} else {
						canvasCtx.lineTo( x, y );
					}

					x += sliceWidth;
				}

				canvasCtx.lineTo( canvas.width, canvas.height/2 );
				canvasCtx.stroke();

				canvasCtx.font = "20px Arial";
				canvasCtx.fillStyle = "rgb(0, 0, 0)";
				canvasCtx.fillText ("Avg: " + (sum / bufferLength), 10, 50);
			};

			draw();
		}
	</script>
	<!-- Social Buttons part2 -->
	<div id="socialButtons">
		<!-- Twitter -->
		<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://nicroto.github.io/viktor/" data-text="Viktor NV-1 Synthesizer. Built on #WebAudio and #WebMIDI API's, #AngularJS, #Stylus, #Browserify." data-via="NikolayTsenkov">Tweet</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

		<!-- Facebook -->
		<div class="fb-like" data-href="https://www.facebook.com/viktorsynth" data-layout="box_count" data-action="like" data-show-faces="false" data-share="true"></div>
	</div>

	<footer-directive></footer-directive>

<!-- App's script -->
<script src="js/app.js"></script>

<!-- Google API (url shortening etc.) -->
<script>
	function initGoogleApi () {
		window.initGoogleApiAngular();
	}
</script>
<script src="https://apis.google.com/js/client.js?onload=initGoogleApi"></script>

</body></html>
